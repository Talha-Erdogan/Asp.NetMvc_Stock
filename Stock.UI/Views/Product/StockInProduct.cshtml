
@{
    ViewBag.Title = "Product";
}

<div class="row">
    <div class="col-sm-12">
        <div class="white-box">
            <h3 class="box-title m-b-0">Products</h3>
            <p class="text-muted m-b-30">
                <div class="row">
                    <div class="col-lg-1 col-md-1 col-sm-2 col-xs-5">
                        <button id="deleteBtn" class="btn btn-block btn-info">Delete</button>
                    </div>
                    <div class="col-lg-1 col-md-1 col-sm-2 col-xs-5">
                        <a href="@Url.Action("Add","Product")" class="btn btn-block btn-info">Add</a>
                    </div>
                </div>
            </p>
            <div class="table-responsive">
                <table id="productTable"></table>
            </div>
        </div>
    </div>
</div>

@section scripts{
    <link href="~/Content/Css/duzenlenen.css" rel="stylesheet" />
    @*<script src="~/Scripts/urun.js"></script>*@
    <script type="text/javascript">
        $(document).ready(function () {
            Urunler();
        });
    </script>
    <script>
        //Ürün Bilgilerini Getir
        function Urunler() {
            var url = '/Product/List';
            $('#productTable').html("");
            var thead = '<thead><tr><th>Select</th><th>Brand</th><th>Name</th><th>Piece</th><th>Buying Price</th><th>Kdv</th><th>Sales</th><th>Edit</th></tr></thead>';
            $('#productTable').append(thead);
            $.getJSON(url, function (data) {
                for (var item in data.Result) {
                    var checkbox = '<input type="checkbox" name="selectedd" value=' + data.Result[item].Id + ' />';
                    var button = '<button id="edit_btn" value="' + data.Result[item].Id + '" class="btn btn-block btn-info">Edit</button>';
                    var user = '<tbody><tr><td>' + checkbox + '</td><td>' + data.Result[item].BrandName + '</td><td>' + data.Result[item].Name + '</td><td>' + data.Result[item].Piece + '</td><td>' + data.Result[item].BuyingPrice + ' TL</td><td>% ' + data.Result[item].Kdv + '</td><td>' + data.Result[item].SalesPrice + ' TL</td><td>' + button + '</td></tr></tbody>';
                    $('#productTable').append(user);
                }
            });
            //var tfoot = '<tfoot><tr><th>Seç</th><th>Marka</th><th>Ad</th><th>Adet</th><th>Alış Fiyatı</th><th>Kdv</th><th>Satış Fiyatı</th><th>Eklenme Tarihi</th><th>Güncelle</th></tr></tfoot>';
            //$('#productTable').append(tfoot);
        };

        //Satılan Ürün Bilgilerini Getir
        function Satilanlar() {
            $('#satilmis').html("");
            var thead = '<thead><tr><th>Marka</th><th>Ad</th><th>Adet</th><th>Alış Fiyatı</th><th>Kdv</th><th>Satış Fiyatı</th><th>Eklenme Tarihi</th><th>Tutar</th></tr></thead>';
            $('#satilmis').append(thead);
            $.getJSON('/Urun/Satilanlar', function (data) {
                for (var item in data.Result) {
                    var user = '<tr><td>' + data.Result[item].Marka + '</td><td>' + data.Result[item].Ad + '</td><td>' + data.Result[item].Adet + '</td><td>' + data.Result[item].AlisFiyat + ' TL</td><td>% ' + data.Result[item].Kdv + '</td><td>' + data.Result[item].SatisFiyat + ' TL</td><td>' + data.Result[item].EklenmeTarih + '</td><td>' + data.Result[item].Tutar + ' TL</td></tr>';
                    $('table#satilmis').append(user);
                }
            });
        };

        //Ürün ekle
        //$("#veri").on("submit", function (event) {
        //    event.preventDefault();
        //    $.ajax({
        //        type: "POST",
        //        url: '/Urun/Ekle',
        //        data: $(this).serialize(),
        //        dataType: "json",
        //        success: function (gelenDeg) {
        //            if (gelenDeg == "1") {
        //                swal("Eklendi", "Müşteri Başarıyla Eklendi!", "success");
        //                setTimeout('direct()', 3000)
        //            }
        //            if (gelenDeg == "2") {
        //                swal("Hata", "Kdv, alış fiyatı ve satış fiyatı nokta ile değil virgül ile ayrılmalıdır!", "error");
        //            }
        //        },
        //        error: function () {
        //            swal("Hata", "Müşteri Eklenirken Hata Oluştu!", "error");
        //        }
        //    });
        //});
        //Ürün sayfasına yönlendir
        function direct() {
            location.href = '/Product/StockInProduct';
        }

        //Ürün sil
        $("#deleteBtn").click(function () {
            var data = [];
            var sayac = 0;
            $("input[name='selectedd']:checked").each(function () {
                data[sayac] = $(this).val();
                sayac++;
            });
            swal({
                title: "Deleting..",
                text: "Are you sure?",
                type: "warning",
                showCancelButton: true,
                confirmButtonClass: "btn-danger",
                confirmButtonText: "Delete",
                closeOnConfirm: false,
                showLoaderOnConfirm: true
            }).then(function () {
                setTimeout(function () {
                    $.ajax({
                        type: "POST",
                        url: '/Product/Delete',
                        data: { data },
                        dataType: "json",
                        success: function (result) {
                            if (result == "1") {
                                swal("Deleted", "Product Delete Successfuly!", "success");
                                Urunler();
                            }
                            else if (result == "2") {
                                swal("Error!", "An error occurred!", "error");
                            }
                        },
                        error: function () {
                            swal("Error!", "An error occurred!", "error");
                        }
                    });
                });
            })
        });

        //Ürün Güncelleme Sayfasına yönlendir
        $(document).on("click", "#edit_btn", function () {
            window.location.href = "/Product/Edit/" + $(this).val();
        });

        //Ürün Güncelle
        $("#veriGuncelle").on("submit", function (event) {
            event.preventDefault();
            $.ajax({
                type: "POST",
                url: '/Urun/Guncelle',
                data: $(this).serialize(),
                dataType: "json",
                success: function (gelenDeg) {
                    if (gelenDeg == "1") {
                        swal("Güncellendi", "Ürün Başarıyla Güncellendi!", "success");
                        setTimeout('direct()', 3000)
                    }
                    else
                        swal("Hata", "Ürün Güncellenirken Hata Oluştu!", "error");
                },
                error: function () {
                    swal("Hata", "Ürün Güncellenirken Hata Oluştu!", "error");
                }
            });
        });

    </script>
}